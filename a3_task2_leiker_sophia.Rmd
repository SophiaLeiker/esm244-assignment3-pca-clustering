---
title: 'Assignment 3: Task 2 - Agglomerative hierarchical clustering'
author: "Sophia Leiker"
date: "2/16/2022"
output: 
  html_document: 
    toc: yes
---

```{r setup, include=TRUE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
library(NbClust)
library(cluster)
library(factoextra)
library(dendextend)
library(ggdendro)
library(here)
library(janitor)
```

## 1. Introduction

This report will use hierarchical clustering by complete linkage to create a dendrogram showing multivariate clustering for water chemistry by site


**Data Source:** SBC LTER: Stream chemistry in the Santa Barbara Coastal drainage area, ongoing since 2000
Creators: Santa Barbara Coastal LTER, & Melack, John M
Citation: Santa Barbara Coastal LTER and J. Melack. 2019. SBC LTER: Land: Stream chemistry in the Santa Barbara Coastal drainage area, ongoing since 2000 ver 16. [Environmental Data Initiative](https://doi.org/10.6073/pasta/67a558a24ceed9a0a5bf5e46ab841174). Meta data including metrics used for each variable and data collection methods can be found [here](https://portal.edirepository.org/nis/metadataviewer?packageid=knb-lter-sbc.6.16). This data package contains stream water chemistry measurements taken in Santa Barbara area watersheds, beginning in 2000. Stream water samples are collected weekly during non-storm flows in winter, and bi-weekly during summer.

Some variables of interest include:

- Total Dissolved Nitrogen uM
- Total Dissolved Phosphorus uM
- Total Particulate Carbon micromolesPerLiter
- Total Particulate Nitrogen micromolesPerLiter
- Total Suspended Solids (milligramPerLiter)


```{r}
# Reading in the data
stream <- read_csv(here("data", "sbc_lter_registered_stream_chemistry.csv")) %>% 
  clean_names()
```


***
## 2. Data Wrangling

- Converting -999 values to NA
- Grouping by site
- Taking the mean of each of the observations and grouping them by site 

```{r}
stream[stream==-999]<-NA

stream_site <- stream %>% 
  select(-timestamp_local) %>% 
  group_by(site_code) %>% 
  summarize(
    "Ammonium" = mean(nh4_u_m, na.rm = TRUE),
    "Nitrate" = mean(no3_u_m, na.rm = TRUE),
    "Phosphorous" = mean(po4_u_m, na.rm = TRUE),
    "Dissolved nitrogen" = mean(tdn_u_m, na.rm = TRUE),
    "Dissolved phosphorous" = mean(tdp_u_m, na.rm = TRUE),
    "Particulate carbon" = mean(tpc_u_m, na.rm = TRUE),
    "Particulate nitrogen" = mean(tpn_u_m, na.rm = TRUE),
    "Particulate phosphorous" = mean(tpp_u_m, na.rm = TRUE),
    "Suspended solids" = mean(tss_mgper_liter, na.rm = TRUE),
    "Specific conductivity" = mean(spec_cond_u_spercm, na.rm = TRUE)
  )
```

```{r}
stream_site_scaled <- stream_site %>% 
  select(-site_code) %>% 
  scale() 
```

***

## 3. Dendrogram

### A. Complete Linkage

```{r}
#Adding row names back in from the original dataset
rownames(stream_site_scaled) <- stream_site$site_code

#creating new dist dataframe
stream_dist <- dist(stream_site_scaled, method = 'euclidean') 
 
### Hierarchical clustering (complete linkage)
#giving it the distance matrix
stream_hc_complete <- hclust(stream_dist, method = "complete")
 
### Plot it (base plot):
plot(stream_hc_complete, cex = 0.6, hang = -1,
     main = "Cluster Dendrogram Illustrating Water Chemistry by Site (Complete)",
     sub = "Data from: Santa Barbara Coastal LTER and J. Melack. 2019",
     xlab = "Stream Site",
     ylab = "Height")

```

**Figure 1**: Cluster dendrogram for illustrating water chemistry by site using complete linkage (clusters are merged by the smallest *maximum* distance between two observations in distinct clusters).

### B. Single Linkage 

```{r}

### Hierarchical clustering (complete linkage)
#giving it the distance matrix
stream_hc_single <- hclust(stream_dist, method = "single")
 
### Plot it (base plot):
plot(stream_hc_single, cex = 0.6, hang = -1,
     main = "Cluster Dendrogram Illustrating Water Chemistry by Site (Single)",
     sub = "Data from: Santa Barbara Coastal LTER and J. Melack. 2019",
     xlab = "Stream Site",
     ylab = "Height")
```

**Figure 2**: Cluster dendrogram for illustrating water chemistry by site using single linkage (single linkage clusters are merged by the *smallest* distance between observations in separate clusters)


```{r}
# Convert to class dendrogram 
dend_complete <- as.dendrogram(stream_hc_complete)
dend_simple <- as.dendrogram(stream_hc_single)
```

Make a tanglegram:
```{r}
#make a tanglegram
tanglegram(dend_complete, dend_simple, main = "Tanglegram: How different linkage changes the clustering", sub = "DATA FROM", lab.cex = 1)
```

***
## 4. Summary


***

## 5. Data Citation

Data source: Santa Barbara Coastal LTER and J. Melack. 2019. SBC LTER: Land: Stream chemistry in the Santa Barbara Coastal drainage area, ongoing since 2000 ver 16. [Environmental Data Initiative](https://doi.org/10.6073/pasta/67a558a24ceed9a0a5bf5e46ab841174)

## END TASK




